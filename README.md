# üñ®Ô∏è PrintApp Manager

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![Expo](https://img.shields.io/badge/Expo-Go-000020?logo=expo)
![Supabase](https://img.shields.io/badge/Supabase-Backend-3ECF8E?logo=supabase)
![TypeScript](https://img.shields.io/badge/TypeScript-4.9-3178C6?logo=typescript)
![License](https://img.shields.io/badge/License-MIT-yellow.svg)

**PrintApp Manager** is a complete mobile solution built with **React Native (Expo)** and **Supabase** designed to streamline the workflow between customers needing printing services and print shop administrators.

The app features role-based access control (RBAC), real-time status updates, file storage management, and a clean, responsive UI with Dark Mode support.

---

## ‚ú® Key Features

### üë§ For Clients
* **Secure Authentication:** Sign up and Sign in with email/password.
* **Order Creation:** Upload documents (PDF, Images) directly from the device or camera.
* **Customization:** Select number of copies, color vs. B/W, and add specific instructions.
* **Real-time Tracking:** Monitor order status (Pending, Processing, Finished).
* **File Preview:** View uploaded documents within the app.
* **Order Management:** Delete orders that are still in "Pending" status (includes automatic file deletion from storage).

### üõ°Ô∏è For Administrators
* **Admin Dashboard:** Quick overview of the shop's activity.
* **Queue Management:** View all "Pending" orders.
* **Order Assignment:** "Assign to me" feature to lock an order for processing.
* **Workflow Control:** Mark orders as "Finished" upon completion.
* **Global History:** Access the full history of completed orders.
* **File Access:** Download or open customer files directly for printing.

### ‚öôÔ∏è Technical Highlights
* **Supabase Backend:** Handles PostgreSQL database, Authentication, and Storage (S3).
* **Row Level Security (RLS):** robust security policies ensuring users only access their own data.
* **Expo Router:** File-based routing for seamless navigation.
* **Dark Mode:** Fully themable UI with persistent preferences.
* **Edge Functions & Cron:** Automated cleanup system to delete old files and database records after 1 week.
* **Robust File Handling:** Uses `ArrayBuffer` for reliable file uploads on Android/iOS.

---

## üõ†Ô∏è Tech Stack

* **Frontend:** React Native, Expo SDK 50+, TypeScript
* **Navigation:** Expo Router v3
* **Backend:** Supabase (PostgreSQL)
* **Storage:** Supabase Storage
* **Styling:** StyleSheet, Custom Theme Provider
* **Icons:** Ionicons (@expo/vector-icons)

---

## üöÄ Getting Started

### Prerequisites
* Node.js (LTS version)
* Expo Go app on your mobile device or an Android/iOS Simulator.
* A Supabase account.

### Installation

1.  **Clone the repository**
    ```bash
    git clone [https://github.com/your-username/print-app.git](https://github.com/your-username/print-app.git)
    cd print-app
    ```

2.  **Install dependencies**
    ```bash
    npm install
    ```

3.  **Environment Setup**
    Create a `.env` file in the root directory and add your Supabase credentials:
    ```env
    EXPO_PUBLIC_SUPABASE_URL=your_supabase_project_url
    EXPO_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
    ```

4.  **Run the App**
    ```bash
    npx expo start
    ```

---

## üóÑÔ∏è Database Setup (Supabase)

To run this app, you need to set up the following tables in your Supabase SQL Editor:

### 1. Enums
```sql
create type "Roles" as enum ('Cliente', 'Administrador');
create type "Estados" as enum ('Esperando', 'Procesando', 'Terminado');
```
### 2. Table: Usuarios (Users)
Links Supabase Auth with app profile data.
```sql
create table "public"."Usuarios" (
    id bigint generated by default as identity primary key,
    auth_id uuid references auth.users not null,
    nombre text not null,
    email text,
    telefono text,
    rol "Roles" default 'Cliente',
    created_at timestamptz default now()
);
```

### 3. Table: Pedidos (Orders)
```sql
create table "public"."Pedidos" (
    id bigint generated by default as identity primary key,
    created_at timestamptz default now(),
    id_cliente bigint references "public"."Usuarios",
    id_admin bigint references "public"."Usuarios",
    descripcion text,
    n_copias int default 1,
    a_color boolean default false,
    estado "Estados" default 'Esperando',
    archivo_url text,
    finished_at timestamptz
);
```

### 4. Storage Bucket
Create a **public** bucket named `documentos`.

---

## üîí Security Policies (RLS)

This app uses strict RLS policies. Ensure you enable RLS on all tables and Storage objects.

* **Users:** Can read/update their own profile.
* **Orders:** Clients can see their own orders. Admins can see all orders.
* **Storage:** Authenticated users can upload. Users can delete their own files (matched by ID).

---

## ü§ñ Automations (Cron)

The system includes a scheduled job (via Supabase Edge Functions or `pg_cron`) that runs daily at midnight to **delete orders and files** that have been in the "Finished" state for more than 7 days, ensuring the database and storage remain clean.

---

## ü§ù Contributing

Contributions are welcome! Please fork the repository and submit a pull request for any improvements.

1.  Fork the Project
2.  Create your Feature Branch (`git checkout -b feature/AmazingFeature`)
3.  Commit your Changes (`git commit -m 'Add some AmazingFeature'`)
4.  Push to the Branch (`git push origin feature/AmazingFeature`)
5.  Open a Pull Request

---

## üìÑ License

Distributed under the MIT License. See `LICENSE` for more information.

---

## ¬© Copyright

**¬© 2026 Afleco.** All rights reserved.
